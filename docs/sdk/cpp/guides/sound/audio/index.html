<html>
<head>
<title>The Sound C API</title>
</head>
<body>
<h1>The Sound C API</h1>
<p>In many games and applications you will want to play a sound. This may be backing music in a game, sound effects or alerts which require user input. The MoSync Sound C API to help you do that.</p>
<p><!--break--><em><strong></strong></em></p>
<p><em><strong>Note</strong></em>: The MoSync Sound C API only supports the playing of one sound at a time. If you want to play multiple sound simultaneously, or stream sounds, use the functions in the <a href="TEMPLATE_DOC_PATH/sdk/cpp/guides/sound/using-audio-api/index.html">MoSync Audio C API</a> instead.</p>
<p>Sound files can come from two places, either sounds you've packaged up with your application when you've distributed it, or they can be downloaded over the data network at runtime. Either way, you need to create a <strong>resource</strong>&nbsp;which the API can recognise and pass to the operating system.</p>
<p>Our guide <a href="TEMPLATE_DOC_PATH/sdk/cpp/tutorials/adding-resources-mosync-project/index.html">Adding Resources to a Project</a> goes into a detail on how to add sound files to your project at build-time for packaging with your release. &nbsp;In short, a sound file needs to be added as either a <strong>.media</strong>&nbsp;or a <strong>.umedia </strong>resource with a MIME type. If you want to make sure that all MoSync supported devices will be able to play your resources it is recommended that you use <em>wav</em> files.</p>
<div class="section"><p>To play sound files you have downloaded, then the easiest way is with the <strong>AudioDownloader</strong>. &nbsp;There is an example which downloads and plays an MP3 file in our guide <a href="TEMPLATE_DOC_PATH/sdk/cpp/tutorials/communication/downloading-audio/index.html">Downloading Audio from the Internet</a>.</p>
<h2>Specifying MIME types</h2>
<p>Whether you are planning on packaging sounds with your application, or planning on downloading it, it is essential that you specify the MIME type of the sound file before you want to play it. The two tutorials linked above contain much more detail about how to do this in each scenario, but this is the short version.</p>
<h4>Specifying MIME types at build-time</h4>
<p>If you are packaging your sounds, you will have an entry in the resource file which looks something like this:</p>
<pre>.res MUSIC
.media "audio/mpeg", "music.mp3"</pre>
<p>The directive <strong>.media</strong>&nbsp;means that it will be treated as a loaded binary resource. &nbsp;That is, it will be loaded into the application memory when the application starts. &nbsp;Alternatively, you can use <strong>.umedia</strong>&nbsp;which will mean that the audio is loaded on demand, but there will be a slight delay.</p>
<p>After the <strong>.media</strong>&nbsp;directive, then there is the MIME type as a string. &nbsp;You can find common MIME types on <a href="http://en.wikipedia.org/wiki/Mime_types">Wikipedia</a>. &nbsp;The final part is the file name you want to enclose.</p>
<h2>Specifying MIME types at run time</h2>
<p>If you are downloading and playing sounds at run time, then you should probably use the <strong>AudioDownloader</strong>&nbsp;class. &nbsp;This is create and configure an appropriate resource for you. When you specify the URL to download from, you also specify the MIME type. The web server you are downloading from (assuming it is a web server) may also provide the MIME type, and may also overwrite your MIME specification.</p>
<h2>Playing Audio Files</h2>
</div>
<!-- /div section --><div class="section"><p>To play a sound you use the <strong>maSoundPlay</strong> function.</p>
<pre class="code"><!-- temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) -->maSoundPlay(RES_SOUND);
</pre>
<p>Just provide the correct resource and the sound file will start playing immediatly if successful. If the function returns any negative value it means that it failed. <br><br>If you, for some reason, wish to stop playing the sound you just use the <strong>maSoundStop</strong> function.</p>
<pre class="code"><!-- temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) -->maSoundStop();</pre>
<p>If you wish to restart the sound you can use this:</p>
<pre class="mosync-code-cpp">if(maSoundIsPlaying())
maSoundStop();
maSoundPlay(RES_AUDIO,&nbsp;0,&nbsp;maGetDataSize(RES_AUDIO));
</pre>
<p>First you can check if your sound is still playing. If so, you can stop it before playing it again. <strong>maSoundPlay</strong> always plays the sound from the beginning. <br><br>Sound volume in MoSync is defined as values between 0 and 100, where 100 is the maximum volume. To get the volume you use:</p>
<pre class="mosync-code-cpp">int&nbsp;volume&nbsp;=&nbsp;maSoundGetVolume();
</pre>
<p>and to set the volume you use:</p>
<pre class="mosync-code-cpp">maSoundSetVolume(volume);
</pre>
<h2><span style="color: #000000;">Example Source Code</span></h2>
</div>
<!-- /div section  temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) --><pre class="mosync-code-cpp">/**
 * @file PlayAudio.cpp
 *
 * This program shows how one can work with playing sounds and music.
 *
 * Todo: You need to add an audio resource file which you want to play.
 * In this example we have used Resource.lst file with following contents:
 * &lt; .res RES_AUDIO
 *   .media "Audio/x-waf", "mobilesorcery2.wav"  &gt;
 *
 * @Author Anders Malm
 */

#include &lt;MAUtil/Moblet.h&gt;
#include "MAHeaders.h"

using namespace MAUtil;

/*
 * Moblet class for playing music.
 */
class MyMoblet : public Moblet
{
public:
    MyMoblet();
    void keyPressEvent(int keyCode);
    void setVolume(int change);
};

/*
 * The constructor for Moblet class
 */
MyMoblet::MyMoblet()
{
    MAExtent e = maGetScrSize();
    maSetColor(0x0);
    maFillRect(0, 0, EXTENT_X(e), EXTENT_Y(e));
    maSetColor(0xffffff);
    maDrawText(0, 0, "Press 5 to Restart sound");
    maDrawText(0, 20, "Press 8 to Stop sound");
    maDrawText(0, 40, "Press 7 to Decrease volume ");
    maDrawText(0, 60, "Press 9 to Increase volume ");
    maDrawText(0, 80, "Press 0 to Exit");
    maUpdateScreen();

    // Panic message in case of failure.
    if(maSoundPlay(RES_AUDIO, 0, maGetDataSize(RES_AUDIO)) &lt; 0)
        maPanic(0,"error playing sound!");
}

/*
 * For controlling music volume.
 */
void MyMoblet::setVolume(int change)
{
    int volume = maSoundGetVolume();
    volume += change;
    if(volume&lt;0) volume = 0;
    else if(volume&gt;100) volume = 100;

    maSoundSetVolume(volume);
}

/*
 * Key press events
 * Pressing key 0, Exits the program.
 * Pressing key 8, Stops playing sound.
 * Pressing key 5, Starts playing sound.
 * Pressing Keys 7 and 9, sets volume down and up respectively.
 */
void MyMoblet::keyPressEvent(int keyCode)
{
    switch(keyCode)
    {
        case MAK_0:
            maExit(0);
            break;
        case MAK_8:
            maSoundStop();
            break;
        case MAK_5:
            if(maSoundIsPlaying())
                maSoundStop();
            maSoundPlay(RES_AUDIO, 0, maGetDataSize(RES_AUDIO));
            break;
        case MAK_7:
            setVolume(-10);
            break;
        case MAK_9:
            setVolume(10);
            break;
    }
}

/**
 * Main execution of the program starts from here.
 */
extern "C" int MAMain()
{
    Moblet::run(new MyMoblet());
    return 0;
};</pre>
</body>
</html>
