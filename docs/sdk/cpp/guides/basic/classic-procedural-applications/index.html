<html>
<head>
<!-- <mosyncheadertags>
<meta name="description" content="In this development model you have full control over (and responsibility for) how the application behaves. This model is most suited when you are porting existing C applications, or you want full control over program flow and events ." />
<meta name="dcterms.description" content="In this development model you have full control over (and responsibility for) how the application behaves. This model is most suited when you are porting existing C applications, or you want full control over program flow and events ." />
<meta name="keywords" content="mobile development,sdk,android,windows mobile,moblin,j2me,symbian,meego,maemo,brew,iphone,c,c++,open source,porting,dev,application,ide,cross platform,programming,deployment,mosync" />
<title>Classic Procedural Applications | MoSync Guide/Tutorial</title>
</mosyncheadertags> -->
</head>
<body>
<h1>Classic Procedural Applications</h1>
<p>In this development model you have full control over (and responsibility for) how the application behaves. This model is most suited when you are porting existing C applications, or you want full control over program flow and events .</p>
<p>
<!--break--></p>

<p>It is important to understand how to correctly implement a MoSync event loop. There three most important points to consider are:</p>

<ul>

<li> Checking for events often enough. The MoSync event queue is not     infinite, so if you don't check often enough you might miss events.</li>

<li> Using <strong>maWait()</strong> rather than busy-waiting, to conserve CPU usage and battery power.</li>

<li> Responding to and handling the close event. After a close event     is posted, your application will be forcibly terminated within a short     period of time. However, your application should voluntarily exit as     soon as possible, having saved any important data. (Note that after the     close event has been posted, no further events will be posted and most     syscalls will have no effect. See syscalls in the <a href="/content/api-reference">API Reference Guide</a> for further     information on this topic.</li>

</ul>

<h2>Example: A Simple, Well-Behaved Application</h2>
<p><pre class="mosync-code-cpp">#include &lt;ma.h&gt;
int MAMain() {
    // Application initialization goes here

    for(;;) {
        MAEvent e;
        // Wait until we have an event
        maWait(0);  
        // Process all events that have occured
        while(maGetEvent(&amp;e)) {
            if(e.type == EVENT_TYPE_CLOSE) {
                // do cleanup
                maExit(0);
            }
            else if(e.type == EVENT_TYPE_KEY_PRESSED) {
                // It's good practise to always provide one key
                // to exit the application.
                if(e.key == MAK_0) {
                    // do cleanup
                    maExit(0);
                }
                // handle other key presses
            }
        }
    }
    return 0;   
}
</pre>
</p>
<p> This example only checks for key presses, but note that results of asynchronous operations are also passed as events and should be handled similarily. See the syscall reference for more information. <br> Working with connections in classic applications involves responding to events whose type is <em>EVENT_TYPE_CONN</em>. Connection operations are executed asynchronously, and these events are the way in which your application is notified of their progress, results and termination.</p>

<h2>Example: A Classic application Using Connections</h2>

<!-- temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) --><p>&nbsp;</p>
<p><pre class="mosync-code-cpp">#include &lt;maapi.h&gt;
#include &lt;conprint.h&gt;
int MAMain() {
&nbsp;&nbsp;&nbsp; char buffer[160];
&nbsp;&nbsp;&nbsp; // Application initialization goes here.
&nbsp;&nbsp;&nbsp; InitConsole();

&nbsp;&nbsp;&nbsp; // Create a connection.
&nbsp;&nbsp;&nbsp; printf("Connecting...\n");
&nbsp;&nbsp;&nbsp; MAHandle conn = maConnect("http://www.example.com/");&nbsp; // Will cause a CONNECT event.
&nbsp;&nbsp;&nbsp; // The event loop.
&nbsp;&nbsp;&nbsp; for(;;) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; MAEvent e;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Wait until we have an event.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maWait(0);&nbsp; 
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Process all events that have occured.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; while(maGetEvent(&amp;e)) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(e.type == EVENT_TYPE_CLOSE) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maExit(0);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else if(e.type == EVENT_TYPE_KEY_PRESSED) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(e.key == MAK_0)
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maExit(0);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else if(e.type == EVENT_TYPE_CONN) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(e.conn.opType == CONNOP_CONNECT) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // The Connect operation is complete.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(e.conn.result &lt; 0) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("Connect error %i\n", e.conn.result);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Close the connection, freeing resources.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maConnClose(conn);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("HTTP result %i\n", e.conn.result);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Start reading data.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maConnRead(conn, buffer, sizeof(buffer) - 1);&nbsp; // Will cause a CONN READ event.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else if(e.conn.opType == CONNOP_READ) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // The Read operation is complete.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(e.conn.result == CONNERR_CLOSED) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("Connection closed.\n");
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maConnClose(conn);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else if(e.conn.result &lt; 0) {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("Read error %i\n", e.conn.result);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maConnClose(conn);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("Read %i bytes:\n", e.conn.result);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Zero-terminate buffer.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; buffer[e.conn.result] = 0;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PrintConsole(buffer);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Read more data.
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; maConnRead(conn, buffer, sizeof(buffer) - 1);
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; return 0;
}&nbsp;</pre>
</p>
</body>
</html>
