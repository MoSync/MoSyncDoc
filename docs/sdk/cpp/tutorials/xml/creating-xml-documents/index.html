<html>
<head>
<title>Creating XML Documents</title>
</head>
<body>
<h1>Creating XML Documents</h1>
<p>I've recently  been working on a project to integrate SyncML into a MoSync  application. SyncML is fantastically simple - there is only one service  end point -<b> <i>if</i></b> you can provide the SyncML server with an  XML description of the data you've got and the data you want.</p>

<!--break-->
<p>MoSync's  XML API (MTXml) is a SAX-like parser for reading XML documents.  It  doesn't have a traversable XML document model, and it can't help in  writing XML.  I put six hours aside, and created the objects to fill  this space.  This way, I can easily create my XML requests for the  SyncML server.</p>

<p>Firstly, a quick warning.  I've not  destruction tested this model.  I've not even read the requirements for  creating XML processors.  It certainly doesn't validate XML, and it  probably won't stop you using it to create incorrect XML.  If you use it  sensibly, then it should work for 99% of the XML you want to use.</p>

<h2>XMLDocument,  XMLNode, XMLAttribute &amp; XMLNamespace</h2>

<p>I've created a traversable  XML model.  At the heart of this is the class XMLDocument.</p>

<pre><span style="font-size: small;"><b><span style="font-family: 'courier new';"><span style="color: #7f0055;">class</span></span></b> <span style="font-family: 'courier new';"><span style="color: #005032;">XMLDocument</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> <br />{<br /></span></span><b><span style="font-family: 'courier new';"><span style="color: #7f0055;">  public</span></span></b><span style="font-family: 'courier new';"><span style="color: #000000;">:<br /></span></span><span style="font-family: 'courier new';"><span style="color: #000000;">     <b>XMLDocument</b>();<br />  <b>  ~XMLDocument</b>();</span></span>  <br />        <span style="font-family: 'courier new';"><span style="color: #005032;">XMLNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">* </span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;</span></span><span style="font-family: 'courier new';"><span style="color: #005032;"><br />     XMLDocument</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">* <b>addNamespace</b>(</span></span><span style="font-family: 'courier new';"><span style="color: #005032;">String</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> prefix, </span></span><span style="font-family: 'courier new';"><span style="color: #005032;">String</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> URI);<br /></span></span><span style="font-family: 'courier new';"><span style="color: #005032;">     Map</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">&lt;</span></span><span style="font-family: 'courier new';"><span style="color: #005032;">String</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #005032;">XMLNamespace</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">*&gt; </span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">namespaces</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;<br />};</span></span></span></pre>

<p>This  contains a pointer to the root XML node (the root element), and a map  of all the namespaces supported in the document.</p>

<p>The  XMLNode is the class which performs most of the work</p>

<pre><b><span style="color: #7f0055;">class</span></b><span style="color: black;"> </span><span style="color: #005032;">XMLNode</span><br /><span style="color: black;">{</span><br /><b><span style="color: #7f0055;">  public</span></b><span style="color: black;">:</span><br /><span style="color: black;"><b>    XMLNode</b>();</span><br /><span style="color: black;"><b>   ~XMLNode</b>();</span><o:p></o:p><br /><br /><span style="color: black;">    </span><span style="color: #005032;">String</span><span style="color: black;"> </span><span style="color: #0000c0;">name</span><span style="color: black;">;</span><br /><span style="color: black;">    </span><span style="color: #005032;">String</span><span style="color: black;"> </span><span style="color: #0000c0;">value</span><span style="color: black;">;</span><o:p></o:p><br /><span style="color: black;">    </span><span style="color: #005032;">Vector</span><span style="color: black;">&lt;</span><span style="color: #005032;">XMLNode</span><span style="color: black;">*&gt; </span><span style="color: #0000c0;">nodes</span><span style="color: black;">;</span><br />    <span style="color: black;"> </span><span style="color: #005032;">Vector</span><span style="color: black;">&lt;</span><span style="color: #005032;">XMLAttribute</span><span style="color: black;">*&gt; </span><span style="color: #0000c0;">attributes</span><span style="color: black;">;</span><br /><span style="color: #005032;">    XMLNamespace</span><span style="color: black;">* </span><span style="color: #0000c0;">xmlNamespace</span><span style="color: black;">;</span><br /><span style="color: black;">    </span><span style="color: #005032;">XMLNode</span><span style="color: black;">* </span><span style="color: #0000c0;">parent</span><span style="color: black;">;</span><span style="color: black;">    </span><span style="color: #005032;">XMLNode</span><span style="color: black;">* </span><span style="color: #0000c0;">root</span><span style="color: black;">;</span><br /><span style="color: black;">    </span><span style="color: #3f7f5f;">//Fluent methods for creating child nodes and attributes</span><span style="color: black;">    </span><span style="color: #005032;"><br />    XMLNode</span><span style="color: black;">* <b>addNode</b>(</span><span style="color: #005032;">String</span><span style="color: black;"> name, </span><span style="color: #005032;">String</span><span style="color: black;"> value = </span><span style="color: #2a00ff;">""</span><span style="color: black;">, </span><span style="color: #005032;">XMLNamespace</span><span style="color: black;">* xmlNamespace = NULL);</span><br />    <span style="color: #005032;">XMLNode</span><span style="color: black;">* <b>addNode</b>(</span><span style="color: #005032;">XMLNode</span><span style="color: black;">* node);</span><o:p></o:p><span style="color: black;"><br /></span><span style="color: black;">    <span style="color: #005032;">XMLNode</span><span style="color: black;">* <b>addAttribute</b>(</span><span style="color: #005032;">String</span><span style="color: black;"> name, </span><span style="color: #005032;">String</span><span style="color: black;"> value = </span><span style="color: #2a00ff;">""</span><span style="color: black;">, </span><span style="color: #005032;">XMLNamespace</span><span style="color: black;">* xmlNamespace = NULL);</span><span style="color: black;"><br /></span><span style="color: black;">    </span><span style="color: #005032;">XMLNode</span><span style="color: black;">* <b>addAttribute</b>(</span><span style="color: #005032;">XMLAttribute</span><span style="color: black;">* attribute);</span><br /><span style="color: #3f7f5f;">    <br />    //Just like addNode, except that the pointer you get back is to the new node</span><br /><span style="color: black;">    </span><span style="color: #005032;">XMLNode</span><span style="color: black;">* <b>addChild</b>(</span><span style="color: #005032;">String</span><span style="color: black;"> name, </span><span style="color: #005032;">String</span><span style="color: black;"> value = </span><span style="color: #2a00ff;">""</span><span style="color: black;">, </span><span style="color: #005032;">XMLNamespace</span><span style="color: black;">* xmlNamespace = NULL);</span><span style="color: black;">    </span><span style="color: #005032;"><br />    XMLNode</span><span style="color: black;">* <b>addChild</b>(</span><span style="color: #005032;">XMLNode</span><span style="color: black;">* node);</span><span style="color: black;">    <br />    <br /></span><span style="color: #005032;">    Vector</span><span style="color: black;">&lt;</span><span style="color: #005032;">XMLNode</span><span style="color: black;">*&gt; <b>find</b>(</span><b><span style="color: #7f0055;">const</span></b><span style="color: black;"> </span><span style="color: #005032;">String</span><span style="color: black;">&amp; key);</span><span style="color: black;">}</span>;</span></pre>

<p>The XMLNode object holds the name and the value of the current node as  strings, and has a collection of XMLNode* as children.  It also has a  collection of XMLAttributes</p>

<pre class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><b><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #7f0055;">struct</span></b><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;"> </span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #005032;">XMLAttribute</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;"><br />{</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><b><br /></b><b><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #7f0055;">  public</span></b><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;">:</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #005032;"> <br />    String</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;"> </span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #0000c0;">name</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;">;</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #005032;"><br />    String</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;"> </span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #0000c0;">value</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;">;</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #005032;"> <br />    XMLNamespace</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;">* </span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: #0000c0;">xmlNamespace</span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;">;</span><span style="font-size: 10pt; font-family: &amp;amp;amp;"><o:p></o:p></span><span style="font-size: 10pt; font-family: &amp;amp;amp; color: black;"><br />}</span>;</pre>

<p>XMLDocument,  XMLNode and XMLAttributes can all refer to an XMLNamespace.  It does  not validate the namespace or apply any rules from it, but it is aware  of namespaces and handles them.</p>

<pre><span style="font-size: small;"><b><span style="font-family: 'courier new';"><span style="color: #7f0055;">struct</span></span></b><span style="color: #005032;"><span style="font-family: 'courier new';"> </span></span><span style="font-family: 'courier new';"><span style="color: #000000;"><span style="color: #008000;">XMLNamespace </span><br />{</span></span> <br /> <b><span style="font-family: 'courier new';"><span style="color: #7f0055;">  public</span></span></b><span style="font-family: 'courier new';"><span style="color: #000000;">:</span></span><span style="color: #000000;"><span style="font-family: 'courier new';"><br />  </span></span>  <span style="font-family: 'courier new';"><span style="color: #005032;">String</span></span><span style="color: #0000c0;"><span style="font-family: 'courier new';"> </span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">prefix</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;</span></span>   <br />      <span style="font-family: 'courier new';"><span style="color: #005032;">String </span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">URI</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;<br />};</span></span></span></pre>

<h2>Creating  a new XMLDocument</h2>

<p>XMLDocuments are created with a default,  empty root node.  Don't create a new one and set the pointer.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">XMLDocument</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> doc;<br />doc.</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">name</span></span> <span style="font-family: 'courier new';"><span style="color: #c86400;">=</span></span> <span style="font-family: 'courier new';"><span style="color: #2a00ff;">"beatles"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;</span></span></span></pre>

<p>You  can add nodes to existing nodes by passing the pointer to the node, or  by calling one of the methods to add nodes.</p>

<p>There are two  methods for adding a new node - <b>addNode </b>and <b>addChild</b>.</p>

<p>Essentially  they both do the same thing - add a new node as a child node.  The  difference between them is that addNode will return a pointer to itself,  and addChild will return a ponter to the new node.</p>

<p>This  is important, as it allows you to create your XML using a fluent  programming style.  Your source code can reflect the data you're  storing, making it much easier to understand the XML you've got.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #000000;">doc.</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;<br />    addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span></span><span style="color: #000000;"><br />          addNode(</span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"name"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"john"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span></span><span style="color: #000000;"><br />          addNode(</span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"instrument"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"guitar"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span><span style="color: #0000c0;"><br />parent</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;<br />    addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />        addNode(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"name"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"paul"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />        addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"instrument"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"bass guitar"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />            addAttribute(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"manufacturer"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"hofner"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span><span style="color: #0000c0;"><br />root</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;<br />    addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />        addNode(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"name"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"george"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span><span style="color: #0000c0;"><br />parent</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;<br />    addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />        addNode(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"name"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"ringo"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span><span style="color: #0000c0;"><br />parent</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;<br />    addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"non-member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />        addNode(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"name"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"yoko"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">);</span></span></span></pre>

<p>You can read the source code as easily as you can read XML.  parent is  a pointer to the node's parent, and root is a pointer to the  root node.</p>

<p>The <b> addAttribute </b>method returns a pointer to <b>XMLNode </b>as well, so you  can create many attributes at the same time</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #000000;">addChild(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"instrument"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"bass guitar"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />     addAttribute(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"manufacturer"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"hofner"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;<br />     addAttribute(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"model"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, </span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"hofner  500/1"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)-&gt;</span></span></span></pre>

<h2>Reading XML</h2>

<p>Alongside this  model, I've created an XMLReader class which will read in XML and create  the XMLDocument for you.  You can use this in two ways.  Firstly, it is  an XmlListener, you can use it with the existing MTXml objects and  create and XMLDocument from a connection.  Secondly, you can pass it a  complete XML string.</p>

<p class="messages"><span style="color: #993300;">Warning  - You will run out of memory really quickly if you start loading large  XML documents. Using the MTXml library is still the best way of  handling XML in MoSync.</span></p>

<p>This is some XML from Yahoo! I've  loaded</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"  standalone="yes" ?&gt;<br />     &lt;rss version="2.0"  xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0"  xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"&gt;<br />     &lt;channel&gt; <br />     &lt;title&gt;Yahoo! Weather -  London, GB&lt;/title&gt;<br />     &lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html&lt;/link&gt;<br />     &lt;description&gt;Yahoo!  Weather for London, GB&lt;/description&gt;<br />     &lt;language&gt;en-us&lt;/language&gt;<br />     &lt;lastBuildDate&gt;Wed,  10 Mar 2010 4:50 pm GMT&lt;/lastBuildDate&gt;<br />     &lt;ttl&gt;60&lt;/ttl&gt;<br />     &lt;yweather:location  city="London" region=""   country="United Kingdom"/&gt;<br />     &lt;yweather:units  temperature="C" distance="km" pressure="mb" speed="km/h"/&gt;<br />     &lt;yweather:wind  chill="-1"   direction="30"   speed="22.53" /&gt;<br />     &lt;yweather:atmosphere  humidity="70"  visibility="9.99"  pressure="1015.92"  rising="0" /&gt;<br />     &lt;yweather:astronomy  sunrise="6:26 am"   sunset="5:55 pm"/&gt;<br />    &lt;image&gt;<br />        &lt;title&gt;Yahoo!  Weather&lt;/title&gt;<br />        &lt;width&gt;142&lt;/width&gt;<br />        &lt;height&gt;18&lt;/height&gt;<br />        &lt;link&gt;http://weather.yahoo.com&lt;/link&gt;<br />        &lt;url&gt;http://l.yimg.com/a/i/us/nws/th/main_142b.gif&lt;/url&gt;<br />    &lt;/image&gt;<br />    &lt;item&gt;<br />         &lt;title&gt;Conditions  for London, GB at 4:50 pm GMT&lt;/title&gt;<br />         &lt;geo:lat&gt;51.51&lt;/geo:lat&gt;<br />         &lt;geo:long&gt;0.07&lt;/geo:long&gt;<br />         &lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html&lt;/link&gt;<br />         &lt;pubDate&gt;Wed,  10 Mar 2010 4:50 pm GMT&lt;/pubDate&gt;<br />         &lt;yweather:condition   text="Mostly Cloudy"  code="28"  temp="4"  date="Wed, 10 Mar 2010 4:50  pm GMT" /&gt;<br />         &lt;description&gt;<br />                  &lt;![CDATA[&lt;img  src="http://l.yimg.com/a/i/us/we/52/28.gif"/&gt;&lt;br /&gt;<br />                  &lt;b&gt;Current  Conditions:&lt;/b&gt;&lt;br /&gt;<br />                  &lt;BR /&gt;&lt;b&gt;Forecast:&lt;/b&gt;&lt;BR /&gt;<br />                  Wed  - Fog Late. High: 6 Low: 2&lt;br /&gt;<br />                  Thu - AM Fog/PM Sun.  High: 6 Low: 2&lt;br /&gt;&lt;br /&gt;<br />                  Mostly Cloudy, 4 C&lt;BR  /&gt;<br />                  &lt;a  href="http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html"&gt;<br />                  Full  Forecast at Yahoo! Weather&lt;/a&gt;&lt;BR/&gt;&lt;BR/&gt;<br />                  (provided  by &lt;a href="http://www.weather.com" &gt;The Weather  Channel&lt;/a&gt;)&lt;br/&gt;<br />                  ]]&gt;<br />         &lt;/description&gt;<br />        &lt;yweather:forecast  day="Wed" date="10 Mar 2010" low="2" high="6" text="Fog Late" code="20"  /&gt;<br />        &lt;yweather:forecast day="Thu" date="11 Mar 2010"  low="2" high="6" text="AM Fog/PM Sun" code="20" /&gt;<br />        &lt;guid  isPermaLink="false"&gt;UKXX0865_2010_03_10_16_50_GMT&lt;/guid&gt;<br />    &lt;/item&gt;<br />  &lt;/channel&gt;<br />&lt;/rss&gt;&lt;!--  api2.weather.ch1.yahoo.com compressed/chunked Wed Mar 10 09:22:06 PST  2010 --&gt;</pre>

<p>I can load it into the XMLReader like this</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">XMLReader</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> reader;<br />XMLDocument&amp;  yahooWeather = reader.parseXML(&lt;XML removed for clarity&gt;);</span></span></span></pre>

<p>I  can test my XML in several ways, and the easiest is to write it out  again and compare it.</p>

<h2>Writing XML</h2>

<p>If I've got a  populated XMLDocument, then I can serialise it to a String.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">XMLWriter</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> xmlw;</span><span style="color: #005032;"><br />String</span></span><span style="font-family: 'courier new';"><span style="color: #000000;"> weather =  xmlw.toString(yahooWeather);</span></span></span></pre>

<p>When I do so,  the XMLWriter produces this XML (indentations and line breaks have been  added to make it more readable)</p>

<pre> &lt;?xml version="1.0"?&gt;<br />   &lt;rss version="2.0"  xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0"  xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"&gt;<br />     &lt;channel&gt;<br />       &lt;title&gt;Yahoo! Weather - London,  GB&lt;/title&gt;<br />        &lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html&lt;/link&gt;<br />        &lt;description&gt;Yahoo! Weather for London,  GB&lt;/description&gt;<br />        &lt;language&gt;en-us&lt;/language&gt;<br />        &lt;lastBuildDate&gt;Wed, 10 Mar 2010 4:50 pm GMT&lt;/lastBuildDate&gt;<br />        &lt;ttl&gt;60&lt;/ttl&gt;<br />        &lt;yweather:location  yweather:city="London" yweather:region="" yweather:country="United  Kingdom" /&gt;<br />        &lt;yweather:units  yweather:temperature="C" yweather:distance="km" yweather:pressure="mb"  yweather:speed="km/h" /&gt;<br />        &lt;yweather:wind  yweather:chill="-1" yweather:direction="30" yweather:speed="22.53" /&gt;<br />        &lt;yweather:atmosphere yweather:humidity="70"  yweather:visibility="9.99" yweather:pressure="1015.92"  yweather:rising="0" /&gt;<br />        &lt;yweather:astronomy  yweather:sunrise="6:26 am" yweather:sunset="5:55 pm" /&gt; <br />        &lt;image&gt;<br />            &lt;title&gt;Yahoo!  Weather&lt;/title&gt;<br />            &lt;width&gt;142&lt;/width&gt;<br />            &lt;height&gt;18&lt;/height&gt;<br />            &lt;link&gt;http://weather.yahoo.com&lt;/link&gt;<br />            &lt;url&gt;http://l.yimg.com/a/i/us/nws/th/main_142b.gif&lt;/url&gt;<br />        &lt;/image&gt;<br />        &lt;item&gt;<br />        &lt;title&gt;Conditions for London, GB at 4:50 pm GMT&lt;/title&gt;<br />        &lt;geo:lat&gt;51.51&lt;/geo:lat&gt;<br />        &lt;geo:long&gt;0.07&lt;/geo:long&gt;<br />        &lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html&lt;/link&gt;<br />        &lt;pubDate&gt;Wed, 10 Mar 2010 4:50 pm GMT&lt;/pubDate&gt;<br />        &lt;yweather:condition yweather:text="Mostly Cloudy"  yweather:code="28" yweather:temp="4" yweather:date="Wed, 10 Mar 2010  4:50 pm GMT" /&gt;<br />        &lt;description&gt;<br />             &lt;img src="http://l.yimg.com/a/i/us/we/52/28.gif"/&gt;<br />             &lt;br /&gt;<br />             &lt;b&gt;Current  Conditions:&lt;/b&gt;<br />             &lt;br /&gt;<br />             Mostly Cloudy, 4 C&lt;BR /&gt;&lt;BR /&gt;<br />             &lt;b&gt;Forecast:&lt;/b&gt;<br />             &lt;BR /&gt;<br />             Wed - Fog Late. High: 6 Low: 2&lt;br /&gt;<br />             Thu - AM Fog/PM Sun. High: 6 Low: 2&lt;br /&gt;<br />             &lt;br /&gt;<br />             &lt;a href=  "http://us.rd.yahoo.com/dailynews/rss/weather/London__GB/*http://weather.yahoo.com/forecast/UKXX0865_c.html"&gt;Full  Forecast at Yahoo! Weather&lt;/a&gt;<br />             &lt;BR/&gt;&lt;BR/&gt;<br />             (provided by &lt;a  href="http://www.weather.com" &gt;The Weather Channel&lt;/a&gt;)<br />             &lt;br/&gt;<br />       &lt;/description&gt;<br />       &lt;yweather:forecast yweather:day="Wed" yweather:date="10 Mar  2010" yweather:low="2" yweather:high="6" yweather:text="Fog Late"  yweather:code="20" /&gt;<br />       &lt;yweather:forecast  yweather:day="Thu" yweather:date="11 Mar 2010" yweather:low="2"  yweather:high="6" yweather:text="AM Fog/PM Sun" yweather:code="20" /&gt;<br />       &lt;guid  isPermaLink="false"&gt;UKXX0865_2010_03_10_16_50_GMT&lt;/guid&gt;<br />    &lt;/item&gt;<br />  &lt;/channel&gt;<br />&lt;/rss&gt;</pre>

<p>The  main things to note are the way the way the writer applies the  namespace explicitly to all of the attributes in a tag with a namespace,  and the way that the CData specifier has been removed.  Adding the  namespace doesn't alter the semantic meaning of the XML, and it will  parse with another XML processor.  Secondly, CData is not passed from  the MTXml library, so I never see it to load it into my model.  This  output XML has been successfully validated at  http://validator.w3.org/check</p>

<p>Reading and writing XML like this  is not the main use for these classes.  MTXml is still the best way to  process incoming XML data.  Where these classes are useful is in  creating XML when you need it to integrate a new service.  To go back to  The Beatles example at the top, the XML writer produces this output.  You can see how the source code above is reflected in the XML.  Again,  the line breaks and indentations have been added for clarity.</p>

<pre>&lt;?xml version="1.0"?&gt;<br />&lt;beatles&gt;<br />     &lt;member&gt;<br />         &lt;name&gt;john&lt;/name&gt;<br />        &lt;instrument&gt;guitar&lt;/instrument&gt;<br />    &lt;/member&gt;<br />    &lt;member&gt;<br />       &lt;name&gt;paul&lt;/name&gt;<br />        &lt;instrument manufacturer="hofner" model="hofner 500/1"&gt;bass  guitar&lt;/instrument&gt;<br />    &lt;/member&gt;<br />    &lt;member&gt;<br />        &lt;name&gt;george&lt;/name&gt;<br />    &lt;/member&gt;<br />    &lt;member&gt;<br />        &lt;name&gt;ringo&lt;/name&gt;<br />    &lt;/member&gt;<br />    &lt;non-member&gt;<br />        &lt;name&gt;yoko&lt;/name&gt;<br />    &lt;/non-member&gt;<br />&lt;/beatles&gt;</pre>

<h2>Extracting  XML from the document</h2>

<p>I've not built an XPath parser.  It is  enormously more complex than any of these classes.  There is a way to  search the XMLDocument though, and that is through its find method.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">Vector</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">&lt;</span></span><span style="font-family: 'courier new';"><span style="color: #005032;">XMLNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">*&gt; <b>find</b>(</span></span><b><span style="font-family: 'courier new';"><span style="color: #7f0055;">const</span></span></b> <span style="font-family: 'courier new';"><span style="color: #005032;">String</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">&amp; key);</span></span></span></pre>

<p>If you call the find method, it  returns a Vector of XMLNode* where the tag exactly matches the search  criteria <i>in the children of the XMLNode you are searching</i>. It doesn't walk the entire model looking  for results, and it doesn't search attributes or values.</p>

<p>For example, if I were to count the number  of children my root node has, I'd think that there were five members of  The Beatles.</p>

<pre><span style="font-size: x-small;"><i><span style="font-style: normal;"><span style="font-size: small;"><b><span style="color: #642880;">printf</span></b><span style="font-family: 'courier new';"><span style="color: #000000;">(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"There are %d  members of The Beatles?\n"</span></span><span style="color: #000000;">, doc.</span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">nodes</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">.size());</span></span></span><br /></span></i></span></pre>

<p>However,  I can filter these by matching against the child tag 'member'.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">Vector</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">&lt;</span></span><span style="font-family: 'courier new';"><span style="color: #005032;">XMLNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">*&gt;  vbeatles = doc.</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;find(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">);</span></span><b><span style="font-family: 'courier new';"><span style="color: #642880;"><br />printf</span></span></b><span style="font-family: 'courier new';"><span style="color: #000000;">(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"There are  actually %d members of The Beatles\n"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">,  vbeatles.size());</span></span></span></pre>

<p>I can also use it to  find deep results.</p>

<pre><span style="font-size: small;"><span style="font-family: 'courier new';"><span style="color: #005032;">XMLNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">*  paulsInstrument = doc.</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;">rootNode</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">-&gt;find(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"member"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)</span></span><span style="font-family: 'courier new';"><span style="color: #c86400;">[</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">1</span></span><span style="font-family: 'courier new';"><span style="color: #c86400;">]</span><span style="color: #000000;">-&gt;find(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"instrument"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">)</span></span><span style="font-family: 'courier new';"><span style="color: #c86400;">[</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">0</span></span><span style="font-family: 'courier new';"><span style="color: #c86400;">]</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">;</span></span><b><span style="font-family: 'courier new';"><span style="color: #642880;"><br />printf</span></span></b><span style="font-family: 'courier new';"><span style="color: #000000;">(</span></span><span style="font-family: 'courier new';"><span style="color: #2a00ff;">"Paul plays  the %s"</span></span><span style="font-family: 'courier new';"><span style="color: #000000;">, paulsInstrument-&gt;</span></span><span style="font-family: 'courier new';"><span style="color: #0000c0;"><span style="background-color: #c0c0c0;">value</span></span></span><span style="font-family: 'courier new';"><span style="color: #000000;">.c_str());</span></span></span></pre>

<p>And  in the console I see:</p>

<pre>Paul plays the bass guitar</pre>
</body>
</html>
